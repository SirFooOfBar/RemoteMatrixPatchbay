<html><body>
<link rel="stylesheet" href="style.css">
<script>
fetch("list_clients/midi").then(response => response.json()).then(data => generate_midi_table(data,"midi_table"));

function any_contains(array1,array2)
{
	for(a of array1) if(array2.contains(a)) return true;
}

function connect_disconnect(box)
{
	input=box.getAttribute("in_port")
	output=box.getAttribute("out_port")
	action=!box.checked?"disconnect":"connect"
	alpha = box
	params={
		method: 'POST',
		body: JSON.stringify([[output,input]])
	}
	
	fetch(action,params).then(data => data.json()).then(data => console.log(data))
}

function generate_midi_table(data,table)
{
	console.log(data.inputs);
	html=`<tr><td><a href="simple.html">simple</a> <a href="advance.html">advance</a> midi</td>`

	for(input of data.inputs['Midi-Bridge'])
	{
		html+=`<td>${input.short_name}</td>`
	}
	html+=`</tr>`

	for(output in data.outputs)
	{
		for(input in data.inputs)
		{
			for(out_port of data.outputs[output])
			{
				html+=`<tr><td>${out_port.short_name}</td>`
				for(in_port of data.inputs[input])
				{
					checked=out_port.connected_to.includes(in_port.name)?"checked":""
					
					html+=`<td>`
					html+=`<input type="checkbox" ${checked} out_port="${out_port.name}" in_port="${in_port.name}" onclick="connect_disconnect(this)">`
					//html+=`${out_port.short_name}:${in_port.short_name}`
					html+=`</td>`
				}
				html+=`</tr>`
			}
		}
	}

	audio_table=document.getElementById(table);
	audio_table.innerHTML=html
}
</script>

<table id="audio_table"></table>
<table id="midi_table"></table>
</body></html>
